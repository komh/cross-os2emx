From f3ff71c38914b58b5d82ad6a0ef51e4b6cd0cc99 Mon Sep 17 00:00:00 2001
From: KO Myung-Hun <komh78@gmail.com>
Date: Sat, 28 Feb 2026 00:07:14 +0900
Subject: [PATCH 3/3] Fix ICE due to __declspec(dllexport) on *-os2-emx target

---
 gcc/config/i386/emx.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/gcc/config/i386/emx.c b/gcc/config/i386/emx.c
index 93c938d09..b84dd9208 100644
--- a/gcc/config/i386/emx.c
+++ b/gcc/config/i386/emx.c
@@ -724,9 +724,14 @@ i386_emx_file_end (void)
                   continue;
                 }
                */
+#ifdef __EMX__
+              /* komh: This causes ICE in
+                 langhooks.c:lhd_set_decl_assembler_name () on EMX target if
+                 __declspec(dllexport) is used.  */
               if (!q->asm_name)
                 q->asm_name = q->exported_name ? q->exported_name
                   : IDENTIFIER_POINTER (DECL_ASSEMBLER_NAME (decl));
+#endif
             }
           if (!q->asm_name)
             q->asm_name = q->exported_name ? q->exported_name : q->name;
-- 
2.28.0

